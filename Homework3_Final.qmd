---
title: "Homework3_Final"
author: Mason Buczek
submission: 06/02/2024
git-hub link: https://github.com/Mason-Buczek/Homework3.git
format: pdf

---
## Load the necessary data, tables, and packages

```{r}
library(tidyverse)
library(readxl)
library(janitor)
library(dplyr)
library(GGally)
library(MuMIn)
library(ggeffects)
library(knitr)

# Read in the excel fike
drought_exp <- read_xlsx(path = "/Users/masonbuczek/Envs-193DS/Homework_3/Valliere_etal_EcoApps_Data.xlsx",
                         sheet = "First Harvest")
```

## Preliminary Data Cleaning

```{r}
# Cleaning the Data
drought_exp_clean <- drought_exp %>% 
  clean_names() %>% # nicer column names
  mutate(species_name = case_when( # Create new column with scientific names
    species == "ENCCAL" ~ "Encelia californica", # bush sunflower
    species == "ESCCAL" ~ "Eschscholzia californica", # California poppy
    species == "PENCEN" ~ "Penstemon centranthifolius", # Scarlet bugler
    species == "GRICAM" ~ "Grindelia camporum", # great valley gumweed
    species == "SALLEU" ~ "Salvia leucophylla", # Purple sage
    species == "STIPUL" ~ "Nasella pulchra", # Purple needlegrass
    species == "LOTSCO" ~ "Acmispon glaber" # deerweed
  )) %>% 
  relocate(species_name, .after = species) %>% # Move species_name column after species
  mutate(water_treatment = case_when( # adding column with full treatment names
    water == "WW" ~ "Well watered",
    water == "DS" ~ "Drought stressed"
  )) %>% 
  relocate(water_treatment, .after = water) # Move water_treatment column after water

# Model Construction

# Model 0: Null model
model0 <- lm(total_g ~ 1, # formula
             data = drought_exp_clean) # data frame

# Model 1: Saturated Model
model1 <- lm(total_g ~ sla + water_treatment + species_name,
             data = drought_exp_clean)
par(mfrow = c(2, 2))

# Model 2: Model total biomass as a function of SLA and water treatment
model2 <- lm(total_g ~ sla + water_treatment,
             data = drought_exp_clean)
par(mfrow = c(2, 2))

# Model 3: Model total biomass as a function of SLA and species
model3 <- lm(total_g ~ sla + species_name,
             data = drought_exp_clean)
par(mfrow = c(2, 2))

#Model 4: (My own model) Model total biomass as a function of water treatment only
model4 <- lm(total_g ~ water_treatment,
             data = drought_exp_clean)
par(mfrow = c(2, 2))

```

# Problem 1: Multiple linear regression: model selection and construction (52 points)

## Part A: Make a table or list of all the models from class and the last one you constructed on your own. Write a caption for your table. (8 points)

```{r}
# Create a data frame to store the model information
model_table <- data.frame(
  ModelNumber = 0:4,
  Predictors = c(
    "(Null Model) No predictors",
    "SLA, Water Treatment, Species",
    "SLA, Water Treatment",
    "SLA, Species",
    "Water Treatment Only")
)

# Rename the column
colnames(model_table)[1] <- "Model Number"

# Store the models in a list
models <- list(model0, model1, model2, model3, model4)

# Calculate AIC for each model
model_table$AIC <- sapply(models, AIC)

# Calculate delta AIC relative to the model with the lowest AIC
model_table$delta_AIC <- model_table$AIC - min(model_table$AIC)

# Rename the column
colnames(model_table)[4] <- "Delta AIC"

table_caption <- "Model Predictors for Predicting Total Biomass\n\n
This table provides an overview of the structure of the 5 models constructed\n
to predict total biomass. The null model does not include any predictors, while\n
the saturated model incorporates specific leaf area (SLA), water treatment, and\n
species as predictors. There are 3 additional models, two involve SLA and water\n
treatment or SLA and species as predictors with the final model having the only\n
predictor of water treatment"

# Print the table with title, caption, and centered column names
print(kable(model_table, "markdown", caption = table_caption, align = "c"))
```

## Part B: Write a 5-6 sentence “statistical methods” section. (8 points)

The central question aims to examine the influence of specific leaf area (SLA), water treatment, and species type have on specific leaf area (mm2/g), root mass (grams), and shoot mass (grams). To accomplish this goal, I constructed multiple models, including a null model and saturated model, and then proceeded to build additional models to explore different combinations of predictors. By comparing these models using criteria such as AICc and model summaries, I aimed to determine the model that best described the variation in total biomass. In selecting the final model, I focused on identifying the model with the lowest AICc value, indicating a better balance between model accuracy and model complexity. Additionally, I paid attention to the coefficients and significance levels of predictors in the final model to ensure they align with theoretical expectations and statistical significance. To visually confirm that the final model conforms to the assumptions of a linear model, To visually confirm that model1 was the best choice as it had the smallest AICc, I utilized diagnostic plots such as residual plots, Q-Q plots, and fitted vs. residuals plots to help assess if the assumptions of linearity, constant variance, and normality of residuals are met. I also examined scatter plots to assess the relationships between predictors and total biomass, ensuring they exhibit linear patterns so I can make sure I am predicting total biomass accurately. On another note, I wanted to see the effect that a singular predictor would have compared to the others that had two or three and that's why I decided to use a singular predictor in model4

## Part C: Make a visualization of the model predictions with underlying data for your “best” model. (20 points)

```{r}
# Extract model predictions
model_preds <- ggpredict(model1, 
                         terms = c("sla",
                                   "water_treatment", 
                                   "species_name"))

# Create a data frame for plotting
model_preds_for_plotting <- model_preds %>%
  rename(sla = x,
         water_treatment = group,
         species_name = facet)

# Create the visualization
ggplot() +
  # Underlying data
  geom_point(data = drought_exp_clean,
             aes(x = sla, y = total_g, color = water_treatment),
             alpha = 0.3) +
  # Model prediction 95% CI ribbon
  geom_ribbon(data = model_preds_for_plotting,
              aes(x = sla, y = predicted,
                  ymin = conf.low, ymax = conf.high,
                  fill = water_treatment),
              alpha = 0.2) +
  # Model prediction lines
  geom_line(data = model_preds_for_plotting,
            aes(x = sla, y = predicted, color = water_treatment)) +
  # Theme adjustments
  theme_classic() +
  # Remove gridlines
  theme(panel.grid = element_blank()) +
  # Facet by species
  facet_wrap(~species_name, scales = "free") +
  # Plot title
  labs(title = "Model Predictions with Underlying Data",
       x = "Specific Leaf Area (SLA)",
       y = "Total Biomass",
       color = "Water Treatment",
       fill = "Water Treatment") +
  # Legend adjustments
  scale_color_manual(values = c("Well watered" = "blue", "Drought stressed" = "red")) +
  scale_fill_manual(values = c("Well watered" = "blue", "Drought stressed" = "red")) +
  theme(legend.position = "none")
```

## Part D: Write a caption for your visualization. (6 points)

Figure 2: Total Biomass (Underlying Data) using 5 Different Model Predictor Combinations

Description:
This figure illustrates the model predictions for total biomass based on specific leaf area (SLA) and water treatment categories (Well watered vs. Drought stressed). The underlying data points represent observed total biomass values. Model predictions are depicted by solid lines, with shaded ribbons indicating the 95% confidence intervals around the predictions. The plot is faceted by species, allowing for comparisons across different plant species. Overall, the visualization provides insight into how SLA and water treatment influence total biomass in various plant species under different water conditions.

Data Citation:
Data source: Valliere, Justin; Zhang, Jacqueline; Sharifi, M.; Rundel, Philip (2019). Data from: Can we condition native plants to increase drought tolerance and improve restoration success? [Dataset]. Dryad. https://doi.org/10.5061/dryad.v0861f7



